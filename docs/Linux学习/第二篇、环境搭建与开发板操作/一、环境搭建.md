# 一、环境搭建

## 1. 通过NFS网络文件共享

NFS（Network File System）是一种网络文件共享协议，最初由Sun Microsystems开发，用于允许不同计算机之间在网络上共享文件和目录。NFS允许一个计算机（NFS服务器）将其本地文件系统中的目录和文件共享给其他计算机（NFS客户端），使多台计算机能够访问和操作这些共享资源，就好像它们是本地文件一样。

---

> **配置步骤：**

配置NFS（Network File System）服务器和客户端涉及多个步骤。以下是一些基本步骤，以帮助你设置NFS共享：

**在NFS服务器上的配置：**

1. **安装NFS服务器：**  如果尚未安装NFS服务器软件，请使用你的Linux发行版的包管理器进行安装。在大多数情况下，软件包名称可能是`nfs-kernel-server`​（Debian/Ubuntu）或`nfs-utils`​（Red Hat/CentOS）。
2. **创建共享目录：**  选择要共享的本地目录，并确保它包含你希望共享的文件和子目录。
3. **编辑NFS配置文件：**  打开NFS服务器的配置文件 `/etc/exports`​ 并添加要共享的目录和相关权限信息。例如：

    ```
    /共享目录 *(rw,sync,no_root_squash)
    ```

    这将允许任何主机以读写方式（`rw`​）访问共享目录，并启用同步写入（`sync`​）和不禁止`root`​用户（`no_root_squash`​）。
4. **导出配置：**  保存配置文件后，使用以下命令重新加载NFS配置：

    ```
    sudo exportfs -ra
    ```

    这将使NFS服务器知道哪些目录应该共享。
5. **启动NFS服务器：**  启动NFS服务器以开始共享配置的目录。

    ```
    sudo systemctl start nfs-kernel-server
    ```
6. **配置防火墙：**  如果你的系统使用防火墙，请确保防火墙允许NFS流量。默认情况下，NFS使用TCP和UDP端口111和2049。

**在NFS客户端上的配置：**

1. **安装NFS客户端：**  如果尚未安装NFS客户端软件，请使用你的Linux发行版的包管理器进行安装。通常，你只需要安装NFS客户端包。
2. **创建本地挂载点：**  在客户端上创建一个本地目录，用于挂载远程NFS共享。

    ```
    sudo mkdir /本地目录
    ```
3. **挂载NFS共享：**  使用`mount`​命令将远程NFS共享挂载到本地挂载点。

    ```
    sudo mount -t nfs 服务器IP:/共享目录 /本地目录
    ```

    替换 `服务器IP`​、`/共享目录`​ 和 `/本地目录`​ 为实际的值。
4. **验证挂载：**  使用`mount`​命令或`df`​命令来验证NFS共享是否已成功挂载。
5. **自动挂载（可选）：**  如果你希望NFS共享在每次系统启动时自动挂载，你可以将挂载信息添加到 `/etc/fstab`​ 文件中。

这些步骤可以帮助你配置NFS服务器和客户端。请记住，在配置时要考虑安全性和权限控制，以确保只有授权用户能够访问共享资源。

> **exports文件权限示例：**

```docker
 /home/hqyj *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)
```

说明：

* ​`/home/hqyj`​: 这是你要共享的目录路径，看起来没问题。
* ​`*(rw,...)`​: 这部分定义了权限。`*(rw,...)`​ 表示允许任何主机以读写方式（`rw`​）访问这个共享。这可能是你想要的，但请务必注意安全性问题。如果你只希望特定主机或网络段访问共享，应明确指定它们的IP地址或子网。
* ​`nohide`​: 这个选项通常与`no_subtree_check`​一起使用，确保在挂载的时候，客户端可以访问到根目录之外的子目录。这通常是一个好的设置，但请确保它符合你的需求。
* ​`insecure`​: 通常不建议使用`insecure`​选项，因为它可能导致安全风险。如果可能，最好避免使用它。如果你必须使用它，确保你的网络环境受到适当的保护。
* ​`async`​: 这表示文件系统将以异步方式处理请求，这可能会提高性能，但如果系统崩溃，可能会导致数据不一致。如果数据完整性对你非常重要，可以考虑使用`sync`​，但这可能会降低性能。
* ​`no_root_squash`​: `no_root_squash`​ 选项禁用了通常的`root`​用户的权限限制。这也可能是安全风险。通常，建议保留`root_squash`​，以限制`root`​用户的权限。

> **mount挂载示例：**
>
> （挂载类似于windows的快捷方式）

自己挂载自己：

```docker
sudo mount  -t nfs -o nolock,vers=3 192.168.50.138:/home/hqyj/ /mnt
```

说明：

* ​`-t nfs`​: 指定挂载的文件系统类型为NFS。
* ​`-o nolock,vers=3`​: 使用了一些选项，`nolock`​用于指定不使用文件锁，`vers=3`​用于指定NFS协议的版本为3。
* ​`192.168.50.138:/home/hqyj/`​: 这是NFS服务器的IP地址和共享的路径。
* ​`/mnt`​: 这是本地目录，你希望将NFS共享挂载到这里。

‍

**开发板挂载虚拟机：**

```docker
mount -t nfs -o nolock,vers=3 192.168.5.11:/home/hqyj /mnt
```

‍

> **如何取消挂载？**

```docker
umount /mnt
# /mnt是挂载的目标目录，取消挂载记得退出挂载目录
```

‍
